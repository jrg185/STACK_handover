<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.T.A.C.K. Handover Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Form</a>

        <div class="header">
            <h1>S.T.A.C.K. Handover Viewer</h1>
        </div>

        <div class="filters">
            <div>
                <label for="filterDepartment">Department:</label>
                <select id="filterDepartment">
                    <option value="all">All Departments</option>
                    <option value="IC">IC</option>
                    <option value="NCG">NCG</option>
                    <option value="RPK">RPK</option>
                    <option value="SSG">SSG</option>
                    <option value="CIG">CIG</option>
                    <option value="WAWA LOAD">WAWA LOAD</option>
                    <option value="WAWA SELECT">WAWA SELECT</option>
                    <option value="DRY LOAD">DRY LOAD</option>
                    <option value="C/F">C/F</option>
                    <option value="C/F LOAD">C/F LOAD</option>
                    <option value="REPLEN">REPLEN</option>
                    <option value="RECEIVING">RECEIVING</option>
                </select>
            </div>

            <div>
                <label for="filterDate">Date:</label>
                <input type="date" id="filterDate">
            </div>

            <div>
                <label for="filterShift">Shift:</label>
                <select id="filterShift">
                    <option value="all">All Shifts</option>
                    <option value="morning">Morning</option>
                    <option value="afternoon">Afternoon</option>
                    <option value="night">Night</option>
                </select>
            </div>
        </div>

        <div id="handoversList">
            <template id="handoverTemplate">
                <div class="handover">
                    <div class="handover-header">
                        <h3>Department: <span class="department"></span></h3>
                        <h3>Shift: <span class="shift"></span></h3>
                        <h3>Submission Time: <span class="submissionTime"></span></h3>
                    </div>

                    <div class="status-section">
                        <h4>Status Overview</h4>
                        <div class="grid">
                            <div>Selection Completion: <span class="selectionCompletion"></span>%</div>
                            <div>Replenishment Completion: <span class="replenishmentCompletion"></span>%</div>
                            <div>Estimated Finish Time: <span class="estimatedFinishTime"></span></div>
                        </div>

                        <div class="staffing-status">
                            <h4>Staffing Status</h4>
                            <table>
                                <tr>
                                    <th>Staff Type</th>
                                    <th>Required</th>
                                    <th>Available</th>
                                    <th>Difference</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>Selectors</td>
                                    <td class="selectorsRequired"></td>
                                    <td class="selectorsAvailable"></td>
                                    <td class="selectorsDifference"></td>
                                    <td class="selectorsNotes"></td>
                                </tr>
                                <tr>
                                    <td>Static</td>
                                    <td class="staticRequired"></td>
                                    <td class="staticAvailable"></td>
                                    <td class="staticDifference"></td>
                                    <td class="staticNotes"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="equipment-status">
                            <h4>Equipment Status</h4>
                            <table>
                                <tr>
                                    <th>Equipment Type</th>
                                    <th>Status</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>Forklifts</td>
                                    <td class="forkliftStatus"></td>
                                    <td class="forkliftNotes"></td>
                                </tr>
                                <tr>
                                    <td>Tuggers</td>
                                    <td class="tuggerStatus"></td>
                                    <td class="tuggerNotes"></td>
                                </tr>
                                <tr>
                                    <td>Pallet Jacks</td>
                                    <td class="palletJackStatus"></td>
                                    <td class="palletJackNotes"></td>
                                </tr>
                                <tr>
                                    <td>Scanners</td>
                                    <td class="scannerStatus"></td>
                                    <td class="scannerNotes"></td>
                                </tr>
                                <tr>
                                    <td>Triggers</td>
                                    <td class="triggerStatus"></td>
                                    <td class="triggerNotes"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="tasks-section">
                        <h4>Tasks in Progress</h4>
                        <table class="tasksTable"></table>
                    </div>

                    <div class="action-plan-section">
                        <h4>Action Plan</h4>
                        <table class="actionPlanTable"></table>
                    </div>

                    <div class="issues-section">
                        <h4>Critical Issues</h4>
                        <table class="issuesTable"></table>
                    </div>

                    <div class="notes-section">
                        <h4>Key Notes</h4>
                        <div class="keyNotes"></div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <!-- Add Firebase Scripts here -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBA_LjilP5G8nagcMtmRfCEIVceT2qObiU",
            authDomain: "stackdb-e1b31.firebaseapp.com",
            projectId: "stackdb-e1b31",
            storageBucket: "stackdb-e1b31.firebasestorage.app",
            messagingSenderId: "54108058421",
            appId: "1:54108058421:web:12bd6e9a59ecca8c50127c"
        };
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        console.log('Firebase initialized');

        // Filter handling
        const filterDepartment = document.getElementById('filterDepartment');
        const filterDate = document.getElementById('filterDate');
        const filterShift = document.getElementById('filterShift');

        // Function to apply filters and load handovers
        async function loadHandovers() {
            const handoversList = document.getElementById('handoversList');
            const template = document.getElementById('handoverTemplate');
            
            try {
                // Start with base query
                let query = db.collection('handovers');

                // Apply department filter
                if (filterDepartment.value !== 'all') {
                    query = query.where('department', '==', filterDepartment.value);
                }

                // Apply shift filter
                if (filterShift.value !== 'all') {
                    query = query.where('shift', '==', filterShift.value);
                }

                // Apply date filter if selected
                if (filterDate.value) {
                    const selectedDate = new Date(filterDate.value);
                    const nextDay = new Date(selectedDate);
                    nextDay.setDate(nextDay.getDate() + 1);
                    
                    query = query.where('timestamp', '>=', selectedDate)
                              .where('timestamp', '<', nextDay);
                }

                // Order by timestamp
                query = query.orderBy('timestamp', 'desc');

                // Get the filtered results
                const snapshot = await query.get();
                
                handoversList.innerHTML = ''; // Clear previous content

                if (snapshot.empty) {
                    handoversList.innerHTML = '<p>No handovers found matching the selected filters.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const handover = doc.data();
                    const handoverElement = template.content.cloneNode(true);

                    // Fill in basic info
                    handoverElement.querySelector('.department').textContent = handover.department;
                    handoverElement.querySelector('.shift').textContent = handover.shift;
                    handoverElement.querySelector('.submissionTime').textContent = 
                        handover.submissionTime ? new Date(handover.submissionTime).toLocaleString() : 'N/A';

                    // Fill in status info
                    handoverElement.querySelector('.selectionCompletion').textContent = handover.selectionCompletion || '0';
                    handoverElement.querySelector('.replenishmentCompletion').textContent = handover.replenishmentCompletion || '0';
                    handoverElement.querySelector('.estimatedFinishTime').textContent = handover.estimatedFinishTime || 'N/A';

                    // Fill in staffing info
                    if (handover.staffing) {
                        const staffing = handover.staffing;
                        
                        // Selectors
                        handoverElement.querySelector('.selectorsRequired').textContent = staffing.selectors.required || '0';
                        handoverElement.querySelector('.selectorsAvailable').textContent = staffing.selectors.available || '0';
                        handoverElement.querySelector('.selectorsDifference').textContent = staffing.selectors.difference || '0';
                        handoverElement.querySelector('.selectorsNotes').textContent = staffing.selectors.notes || '';
                        
                        // Static
                        handoverElement.querySelector('.staticRequired').textContent = staffing.static.required || '0';
                        handoverElement.querySelector('.staticAvailable').textContent = staffing.static.available || '0';
                        handoverElement.querySelector('.staticDifference').textContent = staffing.static.difference || '0';
                        handoverElement.querySelector('.staticNotes').textContent = staffing.static.notes || '';

                        // Add color coding for differences
                        const selectorsDiff = handoverElement.querySelector('.selectorsDifference');
                        const staticDiff = handoverElement.querySelector('.staticDifference');
                        
                        [selectorsDiff, staticDiff].forEach(elem => {
                            const value = parseInt(elem.textContent);
                            elem.style.color = value < 0 ? 'red' : value > 0 ? 'green' : 'black';
                        });
                    }

                    // Fill in equipment status
                    if (handover.equipment) {
                        const equipment = ['forklift', 'tugger', 'palletJack', 'scanner', 'trigger'];
                        equipment.forEach(type => {
                            if (handover.equipment[type + 's']) {
                                handoverElement.querySelector('.' + type + 'Status').textContent = 
                                    handover.equipment[type + 's'].status || 'N/A';
                                handoverElement.querySelector('.' + type + 'Notes').textContent = 
                                    handover.equipment[type + 's'].notes || '';
                            }
                        });
                    }

                    handoversList.appendChild(handoverElement);
                });
            } catch (error) {
                console.error('Error loading handovers:', error);
                handoversList.innerHTML = 'Error loading handovers. Please try again.';
            }
        }

        // Add event listeners for filters
        filterDepartment.addEventListener('change', loadHandovers);
        filterDate.addEventListener('change', loadHandovers);
        filterShift.addEventListener('change', loadHandovers);

        // Load handovers when page loads
        window.addEventListener('DOMContentLoaded', loadHandovers);
    </script>
</body>
</html>
